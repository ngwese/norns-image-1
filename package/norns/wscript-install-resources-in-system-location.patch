From d79f4605b9954781b7b7759eddb80f4a02dbaf0a Mon Sep 17 00:00:00 2001
From: Greg Wuller <greg@afofo.com>
Date: Mon, 2 Sep 2019 22:47:42 -0700
Subject: [PATCH] wscript: Install resources in system location

---
 lua/core/config.lua          | 2 +-
 matron/src/hardware/screen.c | 3 +--
 wscript                      | 4 ++++
 3 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/lua/core/config.lua b/lua/core/config.lua
index fc6b9d3..b2283f4 100644
--- a/lua/core/config.lua
+++ b/lua/core/config.lua
@@ -4,7 +4,7 @@
 -- this consists of search patterns lua will use for require('foo')
 
 local home = os.getenv('HOME')
-local norns = home..'/norns/lua'
+local norns = '/usr/share/norns/lua'
 local sys = norns..'/?.lua;'
 local core = norns..'/core/?.lua;'
 local params = norns..'/core/params/?.lua;'
diff --git a/matron/src/hardware/screen.c b/matron/src/hardware/screen.c
index 1cf064d..7fa5763 100644
--- a/matron/src/hardware/screen.c
+++ b/matron/src/hardware/screen.c
@@ -254,8 +254,7 @@ void screen_init(void) {
 
     for(int i = 0; i < NUM_FONTS; i++) {
         // FIXME should be path relative to norns/
-        snprintf(filename, 256, "%s/norns/resources/%s", getenv(
-                     "HOME"), font_path[i]);
+        snprintf(filename, 256, "/usr/share/norns/resources/%s", font_path[i]);
 
         status = FT_New_Face(value, filename, 0, &face[i]);
         if(status != 0) {
diff --git a/wscript b/wscript
index 0c2a3ae..98188f7 100644
--- a/wscript
+++ b/wscript
@@ -69,3 +69,7 @@ def build(bld):
     bld.recurse('ws-wrapper')
     bld.recurse('sc')
     bld.recurse('crone')
+
+    # Install resources
+    bld.install_files('${PREFIX}/share/norns', bld.path.ant_glob('resources/**/*'), relative_trick=True)
+    bld.install_files('${PREFIX}/share/norns', bld.path.ant_glob('lua/**/*'), relative_trick=True)
-- 
2.20.1

